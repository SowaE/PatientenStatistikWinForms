CREATE DATABASE IF NOT EXISTS Patientenstatistik;

USE Patientenstatistik;

CREATE TABLE Person(
	PersonID INT PRIMARY KEY AUTO_INCREMENT,
	Vorname VARCHAR(50) NOT NULL,
	Nachname VARCHAR(50) NOT NULL,
	Geburtsdatum DATETIME NOT NULL,
	AnschriftID_FK INT UNIQUE NOT NULL
);

CREATE TABLE Patient(
	PatientID INT PRIMARY KEY AUTO_INCREMENT,
	PatientenNr INT UNIQUE NOT NULL,
	PersonID_FK INT UNIQUE NOT NULL,
	PraxisID_FK INT NOT NULL
);

CREATE TABLE Anschrift(
	AnschriftID INT PRIMARY KEY AUTO_INCREMENT,
	Strasse VARCHAR(50) NOT NULL,
	HausNr VARCHAR(3) NOT NULL,
	Land VARCHAR(50) NOT NULL,
	PLZ VARCHAR(5) NOT NULL,
	Ort VARCHAR(50) NOT NULL
);

CREATE TABLE Praxis(
	PraxisID INT PRIMARY KEY AUTO_INCREMENT,
	Praxisname VARCHAR(50) NOT NULL,
	AnschriftID_FK INT NOT NULL
);

CREATE TABLE Anwesenheit(
	AnwesenheitID INT PRIMARY KEY AUTO_INCREMENT,
	Anwesenheitstag DATETIME NOT NULL,
	Grund VARCHAR(50) NOT NULL,
	PatientID_FK int NOT NULL
);

ALTER TABLE Person ADD CONSTRAINT Const_Person_AnschriftID_FK FOREIGN KEY (AnschriftID_FK) REFERENCES Anschrift(AnschriftID);
ALTER TABLE Praxis ADD CONSTRAINT Const_Praxis_AnschriftID_FK FOREIGN KEY (AnschriftID_FK) REFERENCES Anschrift(AnschriftID);
ALTER TABLE Patient ADD CONSTRAINT Const_Patient_PersonID_FK FOREIGN KEY (PersonID_FK) REFERENCES Person(PersonID) ON DELETE CASCADE;
ALTER TABLE Anwesenheit ADD CONSTRAINT Const_Anwesenheit_PatientID_FK FOREIGN KEY (PatientID_FK) REFERENCES Patient(PatientID) ON DELETE CASCADE;
ALTER TABLE Patient ADD CONSTRAINT Const_Patient_Praxis_FK FOREIGN KEY (PraxisID_FK) REFERENCES Praxis(PraxisID) ON DELETE CASCADE;


